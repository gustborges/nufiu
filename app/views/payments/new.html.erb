<!-- app/views/payments/new.html.erb -->
<div class="add-margins">
  <h1>ðŸ’³ Detalhes para Pagamento</h1>
  <p>Confira as informaÃ§Ãµes e adicione os seus dados de pagamento.</p>
</div>

<div class="row orders">
  <div class="col-12 col-md-5 order-col1">
    <h6 class="order-col-title1"><strong>Seu pedido</strong></h6>
    <% current_user.carts.last.cart_plants.each do |cart_plant| %>
      <p><%= cart_plant.amount %> x <%= cart_plant.plant.name %> = R$ <%= cart_plant.plant.price * cart_plant.amount %></p>
    <% end %>
    <hr>
    <p><strong>Total: R$ <%= @cart.amount / 100 %></strong></p>
  </div>
  <div class="col-1"></div>
  <div class="col-12 col-md-6 order-col2">
    <h6 class="order-col-title2"><strong>Dados para entrega</strong></h6>
      <p><%= link_to 'Atualize seus dados', edit_user_registration_path(@cart.user) %></p>
      <p><strong>Nome:</strong> <%= current_user.name %></p>
      <p><strong>Telefone:</strong> <%= current_user.phone %></p>
      <p><strong>E-mail:</strong> <%= current_user.email %></p>
      <p><strong>EndereÃ§o:</strong> <%= current_user.address %></p>
      <p><strong>Complemento:</strong> <%= current_user.address_complement %></p>
      <p><strong>Bairro:</strong> <%= current_user.suburb %></p>
      <p><strong>CEP:</strong> <%= current_user.zip_code %></p>
      <p><strong>ReferÃªncia:</strong> <%= current_user.location_details %></p>
  </div>
</div>
<div class="row order-pay">
  <div class="col-12">
      <button id="pay" class="green-button">Preencher dados de pagamento</button>
      
      <script src="https://js.stripe.com/v3/"></script>
      <script>
        const paymentButton = document.getElementById('pay');
        paymentButton.addEventListener('click', () => {
          const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
          stripe.redirectToCheckout({
            sessionId: '<%= @cart.checkout_session_id %>'
          });
        });
      </script>
  </div>
</div>
